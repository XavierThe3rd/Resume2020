export default class SmoothScroll {
  constructor() {
    this.moving = false
    this.posi = window.pageYOffset
    this.posi2 = window.pageYOffset
    this.target =
      document.scrollingElement ||
      document.documentElement ||
      document.body.parentNode ||
      document.body
    this.scrolled1 = this.scrolled1.bind(this)
    this.scrolled2 = this.scrolled2.bind(this)
    this.normalizeWheelDelta = this.normalizeWheelDelta.bind(this)
  }

  normalizeWheelDelta = e => {
    if (e.detail) {
      if (e.wheelDelta)
        return (e.wheelDelta / e.detail / 40) * (e.detail > 0 ? 1 : -1)
      else return -e.detail / 3
    } else return e.wheelDelta / 200
  }

  scrolled1(e) {
    let update = () => {
      this.posi2 = 0
      this.moving = true
      let delta = (this.posi - this.target.scrollTop) / 12
      this.target.scrollTop += (this.posi - this.target.scrollTop) / 12
      Math.abs(delta) > 1 ? requestFrame(update) : (this.moving = false)
    }
    e.preventDefault()
    let delta = this.normalizeWheelDelta(e)
    this.posi += -delta * 200
    this.posi = Math.max(
      0,
      Math.min(this.posi, this.target.scrollHeight - this.target.clientHeight)
    )
    if (!this.moving) update()
  }

  scrolled2(e) {
    let update = () => {
      this.moving = true
      this.posi = 0
      let delta = (this.posi2 - this.target.scrollTop) / 12
      this.target.scrollTop += (this.posi2 - this.target.scrollTop) / 12
      Math.abs(delta) > 1 ? requestFrame(update) : (this.moving = false)
    }
    e.preventDefault()
    let delta = this.normalizeWheelDelta(e)
    this.posi2 += -delta * 200
    this.posi2 = Math.max(
      0,
      Math.min(this.posi2, this.target.scrollHeight - this.target.clientHeight)
    )
    if (!this.moving) update()
  }

  switchScroll = () => {
    let bool = document.querySelector('#boolState')
    if (bool.classList.contains('true')) {
      bool.classList.replace('true', 'false')
      window.removeEventListener('wheel', this.scrolled1, { passive: false })
      setTimeout(() => {
        window.scrollTo(0, 0)
        window.addEventListener('wheel', this.scrolled2, { passive: false })
      }, 500)
    } else {
      bool.classList.replace('false', 'true')
      window.removeEventListener('wheel', this.scrolled2, { passive: false })
      setTimeout(() => {
        window.scrollTo(0, 0)
        window.addEventListener('wheel', this.scrolled1, { passive: false })
      }, 500)
    }
  }
}

let requestFrame = (() => {
  return (
    window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.oRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function(func) {
      window.setTimeout(func, 1000 / 50)
    }
  )
})()
